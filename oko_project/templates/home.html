<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Bitrix Integration</title>
    <script src="//api.bitrix24.com/api/v1/"></script>
    <script>
        BX24.init(function() {
            const initData = BX24.getAuth();
            console.log("initData: ", initData);
    
            if (!initData.access_token) {
                console.error("Access token not found.");
                return;
            }
    
            checkApiAccess(initData.access_token);
        });
    
        function checkApiAccess(accessToken) {
            const url = '/api/bitrix/proxy/?access_token=' + accessToken;
    
            fetch(url, {
                method: 'GET',
            })
            .then(response => {
                console.log("Response status:", response.status);
                if (!response.ok) {
                    return response.json().then(errorData => {
                        throw new Error('Network response was not ok: ' + JSON.stringify(errorData));
                    });
                }
                return response.json();
            })
            .then(data => {
                console.log("Данные пользователя:", data);
                alert("Доступ к API успешен! Данные пользователя: " + JSON.stringify(data));
            })
            .catch(error => {
                console.error("Ошибка при получении данных:", error);
                alert("Ошибка доступа к API: " + error.message);
            });
        }
    </script>
    
</head>
<body>
    <h1>Bitrix24 Integration Example</h1>
</body>
</html>
